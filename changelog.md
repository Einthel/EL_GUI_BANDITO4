# Changelog

Все заметные изменения в этом проекте будут задокументированы в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
и этот проект придерживается [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

## [0.0.5] - 2026-01-29
### Added
- **UI улучшения (Bandito):**
    - Добавлены иконки для кнопок управления плагинами (`add`, `delete`, `reload`) в главном окне.
    - Реализовано новое модальное окно добавления плагинов (`src/plugin_list.py`), вызываемое по кнопке "Добавить" в слотах плагинов.
- **Plugin List UI:**
    - Окно списка плагинов сканирует директорию `plugins/`.
    - Поддержка чтения метаданных (имя, ID, версия, иконка) из `_manifest.json` каждого плагина.
    - В списке плагинов отображается уникальная иконка плагина (если задана) и его версия.
- **Управление плагинами:**
    - Реализовано назначение плагинов на 5 слотов интерфейса.
    - Данные о назначенных плагинах сохраняются в `configs/el_plugin_config.json`.
    - Добавлен функционал **Hot Reload** (кнопка обновления): перезагрузка метаданных (версии, имени) плагина без перезапуска приложения.
    - Добавлен функционал **Delete** (кнопка удаления): очистка слота от плагина.
    - При старте приложение автоматически восстанавливает назначенные плагины в слоты.
    - Реализовано динамическое отображение интерфейса плагина (UI) в главном окне сервера (`right_frame`).
    - **Plugin Switcher:**
        - Кнопки выбора слота (`switch_push_1-5`) работают как переключатели (Radio Button behavior).
        - При активации кнопки загружается UI назначенного плагина.
        - При деактивации UI очищается.
        - При назначении нового плагина он автоматически активируется.
        - **[NEW] Sync:** Состояние активного слота синхронизируется между сервером и всеми клиентами.
- **Client Side (UI):**
    - **[NEW] LED Indication:** Реализована световая индикация активного плагина (`plugin_led_lineE`).
    - Активный слот подсвечивается зеленым (`plugin_active`), остальные — стандартным стилем.
    - Состояние индикаторов обновляется при загрузке плагина и очистке слота.
### Added
- **Система обновления плагинов (Plugin Auto-Update):**
    - Реализована полноценная система автоматического обновления плагинов, независимая от ядра.
    - **Server Side:** Добавлена обработка команд `PLUGIN_UPDATE_GET_VER` и `PLUGIN_UPDATE_GET_MANIFEST` в WebSocket-сервере. Поддержка динамического MD5-хеширования файлов плагинов.
    - **Client Side:** Создан `el_cliento/cliento_plugin_updater.py` — модульный апдейтер, который сканирует установленные плагины и обновляет их по отдельности.
    - **Bootstrap:** Механизм автоматической установки новых плагинов через основной манифест (`cliento_manifest.json`), который разворачивает базовую структуру плагина для его последующего обновления.
- **Манифест:** Актуализирован `cliento_manifest.json`, добавлена поддержка директивы `plugins/` для корректной установки структуры.
- **Плагин Shortcut:** Обновлен манифест плагина (`plugins/shortcut/shortcut_manifest.json`) с корректными путями.

## [0.0.4] - 2026-01-23
### Added
- **Система автообновления (Auto-Update System):**
    - Реализован механизм автоматического обновления клиента (`el_cliento`) при запуске.
    - **Server Side:** Добавлены WebSocket-команды `UPDATE_GET_VER`, `UPDATE_GET_MANIFEST`, `UPDATE_DOWNLOAD_FILE` для раздачи файлов.
    - **Client Side:** Создан модуль `el_cliento/cliento_updater.py`, который:
        1. Сверяет версию клиента с серверной.
        2. Запрашивает манифест обновлений (`cliento_manifest.json`).
        3. Скачивает и заменяет файлы при необходимости.
        4. Автоматически перезапускает клиент после обновления.
    - **Manifest:** Введен файл `el_cliento/cliento_manifest.json`, описывающий список файлов и директорий, подлежащих синхронизации.
    - **[NEW] MD5 Verification:** Внедрена проверка целостности файлов.
        - Сервер динамически вычисляет MD5 хеши файлов перед отправкой манифеста.
        - Клиент сверяет локальные файлы с манифестом: если хеши совпадают, скачивание пропускается (Incremental Update).
        - Клиент проверяет MD5 скачанных данных перед записью на диск для защиты от поврежденных пакетов.
    - **[NEW] Dev Mode:** Добавлена опция `dev_mode: true` в конфиг клиента.
        - Позволяет игнорировать совпадение номеров версий.
        - Форсирует проверку изменений в файлах (MD5 Sync) при каждом запуске для ускорения разработки.

### Changed
- **Архитектура Клиента (RPi Optimization):**
    - **[PERFORMANCE]** Полностью удалена компиляция UI файлов (`.ui` -> `.py`) на стороне клиента.
    - Клиент теперь получает готовые скомпилированные интерфейсы (`resources/ui_done`) с сервера во время обновления.
    - Это снижает время запуска на Raspberry Pi и устраняет необходимость в dev-зависимостях (PySide6 Tools) на клиенте.
- **Точка входа (el_cliento.py):**
    - Добавлен вызов `cliento_updater.check_and_update()` перед инициализацией GUI.
    - Удалены импорты `manager_compile` и логика перекомпиляции.

## [0.0.3] - 2026-01-21
### Added
- **Документация и Процессы:**
    - **CONTEXT.md:** Внедрен файл "Context Handover" для сохранения технического контекста и быстрой синхронизации между этапами разработки.
    - **README.md:** Полностью обновлена структура, добавлено двуязычное описание (RU/EN).
    - **Git:** Актуализирован `.gitignore` (исключение `__pycache__`, логов, артефактов сборки UI).
- **Плагины:**
    - **Shortcut:** Создан первый черновой вариант плагина "shortcut" (структура папок, UI файлы, заготовки логики).
- **Архитектура:**
    - Создан `src/plugin_interface.py` (подготовка к реализации базового класса `ElPlugin`).

### Changed
- **UI:**
    - Переработан визуальный интерфейс сервера (`el_gui_bandito`) и клиента (`el_gui_cliento`).
- **Code Cleanup:**
    - Завершена очистка `src/utilts.py`: удалены остатки старой логики компиляции после миграции на `src/manager_compile.py`.

## [0.0.2] - 2026-01-20
### Changed
- **Рефакторинг системы компиляции UI:**
    - Вся логика компиляции перенесена из `src/utilts.py` в новый модуль `src/manager_compile.py`.
    - Реализована функция `compile_plugin_ui_files` для поддержки плагинов.
    - Внедрена гибридная схема компиляции:
        - Основной UI: Source (`resources/ui_raw`) -> Destination (`resources/ui_done`).
        - Плагины: In-Place (`plugins/../name.ui` -> `plugins/../ui_name.py`) для сохранения автономности модулей.
    - Обновлены точки входа (`el_bandito.py`, `el_cliento.py`) для использования нового менеджера компиляции.

## [0.0.1] - 2026-01-18
### Added
- **Плагины (Менеджер Плагинов):**
    - Добавлен интерфейс менеджера плагинов (`PluginManagerWindow`).
    - Реализован вызов менеджера плагинов из главного окна сервера (`el_bandito`) по кнопке `plugin_toolB`.
    - Окно менеджера открывается в модальном режиме (`Qt.ApplicationModal`), блокируя доступ к основному окну до закрытия.
    - Исходный код логики менеджера выделен в `src/manager_plugin.py`.
- **Коммуникация (WebSocket):**
    - Реализован WebSocket сервер на базе `FastAPI` + `Uvicorn` внутри приложения `el_bandito`. Сервер запускается в отдельном потоке `QThread` и не блокирует интерфейс.
    - Реализован WebSocket клиент `BanditoClient` (на базе `QWebSocket` и `QAbstractSocket`) в `el_cliento` с поддержкой авто-переподключения.
    - Двусторонний обмен JSON-сообщениями.
- **Интерфейс и UX:**
    - Реализована визуальная индикация статуса сети (Connect/Disconnect):
        - Поля статуса меняют цвет (Зеленый/Красный) в зависимости от состояния подключения.
        - Использованы JSON-файлы стилей (`style_bandito.json`, `style_cliento.json`) для гибкой настройки темы (Dark Theme).
    - Внедрена система глобального применения стилей при запуске.
- **Настройки (Bandito & Cliento):**
    - Ручное управление `IP Source` вместо авто-определения (теперь поле редактируемое и сохраняемое).
    - **[NEW]** Полная реализация сохранения настроек клиента (`el_cliento`) в `configs/el_cliento_config.json`.
    - Улучшенный механизм Ping:
        - Отправка 4 пакетов по 32 байта (стандарт).
        - Парсинг вывода консоли для отображения среднего времени отклика или конкретной ошибки ("Превышен интервал...", "General failure").
        - Поддержка кодировки `cp866` для корректного чтения вывода в русской Windows.
        - Асинхронное обновление UI (`processEvents`) во время пинга.
        - **[FIX]** Убран жесткий таймаут процесса ping, что предотвращает ложные срабатывания "TIMEOUT" на медленных сетях.
    - Реализовано окно настроек с валидацией полей.
    - Валидация IP (RegExp), Порта (Int) и Логина (без пробелов).
    - Сохранение конфигурации в JSON (с шифрованием пароля Base64+XOR).
- **Инфраструктура:**
    - Создан универсальный `ConfigManager` для работы с настройками.
- Добавлена структура проекта: разделение на Client (RPi) и Server (PC).
- Реализована автоматическая компиляция `.ui` файлов при запуске.

### Changed
- Поле `IP Source` в настройках теперь доступно для ручного ввода.
- Изменена структура хранения ресурсов: исходники в `ui_raw`, готовые файлы в `ui_done`.
- Переименованы основные директории и файлы запуска:
    - `server_pc/` -> `el_bandito/`
    - `client_rpi/` -> `el_cliento/`
    - `ban_main.py` -> `el_bandito.py`
    - `cli_main.py` -> `el_cliento.py`
- Оптимизированы импорты модулей для корректной работы внутри пакетов.
### Added
- Инициализация репозитория.
- Базовые файлы `.ui` (el_gui_bandito, el_gui_cliento, bandito_settings, cliento_settings).
